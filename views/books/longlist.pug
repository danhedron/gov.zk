//- Used for testing: [squeamish ossifrage]
extends ../skeleton
block breadcrumb
  li
    a(href='/book-club') Book club
  li
    a(href='/book-club/long-list') Long list
block content
  h1.heading-xlarge Long list
  .grid-row
    .column-two-thirds
      p.lede.
        The first step in deciding which books to read is to narrow
        down the many available novels into a smaller list.
      p.font-small.
        This longlist is an initial, longer list from which a
        shortlist will be extracted. Accordingly, feel free to add
        any books that could be good to read: the less appropriate
        novels will be filtered away later, so don't worry too much.
      p.panel.
        Books without a <span class="green">✓</span> have problems
        with metadata and cause difficulties with the shortlisting process.
        Please add or change the ISBN of these books to a different
        edition so the images and other metadata is available.
    if req.user
      .grid-row
        .column-two-thirds
          p
          p
            a(href='long-list/add-a-book').button Add a book
    .grid-row
      .column-full
        table
          thead
            tr
              th
              th Title
              th Author
              th(colspan="2") Status
          - i = 0
          for book in books
            - i++
            tr
              if book.isbn
                td.numeric
                  a(href='book/'+book.isbn)
                    if book.upstream && book.upstream.imageLinks && book.upstream.imageLinks.smallThumbnail
                      img(src=book.upstream.imageLinks.smallThumbnail, style="height:2em")
                    else
                      span #{i}
              else
                td.numeric #{i}
              td
                em #{book.title}
              td #{book.author}
              if book.isbn 
                //- user supplied ISBN
                if book.upstream
                  //- upstream data fetched
                  if book.upstream.imageLinks && book.upstream.imageLinks.thumbnail && book.upstream.description
                    if book.longlistedBy === req.user
                      td.green ✓
                      td (yours)
                    else
                      td(colspan="2").green ✓
                  else
                    //- bad upstream
                    td.red ✗
                    td
                      details
                        summary
                          span.summary Edit ISBN
                        form(method='POST')
                          // label(for='isbn'+i) ISBN
                          input(type='hidden',name='title',value=book.title)
                          input(type='hidden',name='author',value=book.author)
                          input(type='text',name='isbn',style='width:initial;',id='isbn'+i,placeholder=book.isbn,size='11').form-control
                          input(type='submit',value='Edit ISBN').button
                else
                  //- no upstream
                  td.red ✗
                  td
                    a(href='book/'+book.isbn) Get data
              else
                  td.red ✗
                  td
                    details
                      summary
                        span.summary Add ISBN
                      form(method='POST')
                        // label(for='isbn'+i) ISBN
                        input(type='hidden',name='title',value=book.title)
                        input(type='hidden',name='author',value=book.author)
                        input(type='text',name='isbn',style='width:initial;',id='isbn'+i,placeholder=book.isbn,size='11').form-control
                        input(type='submit',value='Add ISBN').button
    if req.user
      .grid-row
        .column-two-thirds
          p
          p
            a(href='long-list/add-a-book').button Add a book
